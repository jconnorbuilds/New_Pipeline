!function(){"use strict";var e,t={7418:function(e,t,r){var n={};r.r(n),r.d(n,{defineMenu:function(){return w},form:function(){return g},launchModal:function(){return _},submitForm:function(){return T}});var a=jQuery,o=r.n(a);const s=document.querySelector("[name=csrfmiddlewaretoken]")?document.querySelector("[name=csrfmiddlewaretoken]").value:null,c=(e,t={})=>{const r=document.createElement(e);return t.classes&&("string"==typeof t.classes?r.classList.add(t.classes):r.classList.add(...t.classes)),t.attributes&&Object.keys(t.attributes).forEach((e=>{r.setAttribute(e,t.attributes[e])})),t.text&&(r.textContent=t.text),t.children&&t.children.forEach((e=>{r.appendChild(c(...e))})),t.id&&(r.id=t.id),t.data&&Object.keys(t.data).forEach((e=>{r.dataset[e]=t.data[e]})),r},d=document.querySelector("#calcInput"),i=document.querySelector("#calcResult"),l=document.querySelector("#calcFrom"),u=document.querySelector("#calcTo"),p=(e,t)=>{const r=c("option",{attributes:{value:e},text:e});return r.value===t&&r.setAttribute("selected",""),r};var m=(()=>{const e=e=>{Object.keys(e).sort().forEach((e=>{const t=p(e,"JPY"),r=p(e,"EUR");l.appendChild(t),u.appendChild(r)}));const t=(e,t)=>{return e.value?r(e,t):(n=t,e.value=0,n.value="0.00");var n},r=(t,r)=>{var n,a,o,s,c;return t.value=(n=t.value,parseInt(n.replaceAll(",","")).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),r.value=(e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))((a=t.value,o=e[l.value],s=e[u.value],(c=a,parseInt(c.replaceAll(",",""))*(o/s)).toFixed(2))),r.value};d.addEventListener("input",(()=>t(d,i))),[l,u].forEach((e=>{e.addEventListener("change",(()=>t(d,i)))}))};return{setup:()=>{var t;t=t=>e(t),o().ajax({headers:{"X-CSRFToken":s},method:"GET",url:"/pipeline/forex-rates",dataType:"json",success:t,error:e=>alert(e)})}}})(),b=DataTable,v=r.n(b),f=r(9635),h=r.n(f);const y=(e,t,r="next")=>{console.log({costID:e},{table:t}),o().ajax({headers:{"X-CSRFToken":s},url:"/pipeline/request-single-invoice/"+e+"/",method:"POST",data:{pay_period:r},dataType:"json",success:function(e){console.log("invoice request callback: ",e),new(v())(t).row(`#${e.response.id}`).data(e.response).invalidate().draw(!1)},error:e=>{console.warn(e),alert("There was an error. Try again, and if the error persists, request the invoice the old fashioned way")}})},g=document.querySelector("form#pay-period-form"),E=document.querySelector("#pay-period-modal"),S=new(h())(E),w=e=>e.querySelector("ul.dropdown-menu > li"),q=document.querySelector("#pay-period-modal .invoice-desc");E.addEventListener("hide.bs.modal",(()=>{g.reset(),q.innerHTML=""}));const T=(e,t)=>{e.preventDefault();const r=document.querySelector("#pay-period-form #id_cost_id").value,n=document.querySelector("#pay-period-form #id_pay_period").value;y(r,t,n),S.hide()},_=e=>{console.log({rowData:e});const t=document.querySelector("#pay-period-modal #id_cost_id");[`Vendor name: ${e.vendor_name}`,`PO number: ${e.PO_number}`,`Job name: ${e.job_name}`].forEach((e=>{const t=document.createElement("p");t.textContent=e,q.appendChild(t)})),t.value=e.id,S.show()};window.$=o();const x=(e,t,r,n)=>{const a=document.createElement("option");a.value=e,a.text=t,r.appendChild(a),e==n.vendor_id&&a.setAttribute("selected","")},j=(document.querySelectorAll(".display-filter .status-filter"),e=>{e.addEventListener("change",(e=>{e.target.matches("select.status")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,a=t.closest("tr").getAttribute("id");o().ajax({headers:{"X-CSRFToken":s},method:"POST",url:"/pipeline/update-invoice-table-row",data:{status:n,cost_id:a},dataType:"json",success:e=>O(e,r),error:e=>console.warn(e)})})(e),e.target.matches("select.vendor")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,a=t.closest("tr").getAttribute("id");o().ajax({headers:{"X-CSRFToken":s},method:"POST",url:"/pipeline/update-invoice-table-row",data:{vendor:n,cost_id:a},dataType:"json",success:e=>O(e,r),error:e=>console.warn(e)})})(e)}))}),O=(e,t)=>{"success"===e.status?new(v())(t).ajax.reload():console.error(e.message)};var A=r.p+"assets/images/pencil-square.svg",L=r.p+"assets/images/trash3-fill.svg";let C,F;var k=(()=>{const e=()=>C||(F=document.querySelector("#cost-table"),C=new(v())(F,{paging:!1,processing:!0,autoWidth:!0,order:[[0,"asc"]],orderClasses:!1,language:{searchPlaceholder:"コストを探す",search:"",emptyTable:"No costs for this job!"},ajax:{url:"/pipeline/cost-data/"+window.location.href.split("/").slice(-2,-1)[0]},rowId:"id",columns:[{data:"amount_JPY",className:"dt-right pe-4",render:e=>(e=>"¥"+e.toLocaleString())(e)},{data:"amount",className:"dt-right pe-4",render:(e,t,r)=>{return n=e,"JPY"==(a={name:r.currency,symbol:r.currency_symbol}).name?"":a.symbol+n.toLocaleString();var n,a}},{data:"vendor_name",render:(e,t,r)=>(e=>{const t=e.vendors_dict?e.vendors_dict:null,r=document.createElement("select");return r.classList.add("form-control-plaintext","vendor"),r.setAttribute("name","vendor-select"),x(0,"Select vendor",r,e),t&&Object.entries(t).forEach((([t,n])=>{x(t,n,r,e)})),r.outerHTML})(r)},{data:"description",render:e=>((e,t=30)=>{const r=Math.round(.5*t),n=(e=>{const t=e.match(/[\u3040-\u309F\u30A0-\u30FF\uFF01-\uFF5E\u4E00-\u9FAF\u3400-\u4DBF]/gu);return t?t.length:0})(e),a=e.length;return n>r?e.substring(0,r)+"...":n>=.66*t&&a>.5*t?e.substring(0,Math.round(.5*t))+"...":n>=.33*t&&a>.33*t?e.substring(0,.33*t)+"...":n>=.125*t&&a>.83*t?e.substring(0,Math.round(.83*t))+"...":a>t?e.substring(0,t)+"...":e})(e)},{data:"PO_number"},{data:"invoice_status",orderDataType:"dom-cost-select",className:"p-0",render:(e,t,r)=>((e,t)=>{const r=t.invoice_status_choices,n=document.createElement("select");n.classList.add("form-control-plaintext","status","p-0"),n.setAttribute("name","invoice_status");for(const[t,a]of Object.entries(r)){const t=document.createElement("option");t.value=a[0],t.text=a[1],a[0]===e&&t.setAttribute("selected",""),n.appendChild(t)}return n.outerHTML})(e,r)},{data:"pay_period",render:e=>(e=>{if(e){const t=new Date(e);return`${new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"long",timeZone:"UTC"}).format(t)}末`}return"-"})(e)},{data:"id",render:(e,t,r)=>((e,t)=>{const r=document.createElement("div");r.classList.add("btn-group","btn-group-sm"),r.setAttribute("role","group"),r.setAttribute("aria-label","Invoice request button with nested dropdown");const n=document.createElement("button");n.classList.add("btn","btn-primary","inv-req","inv-req-btn"),n.setAttribute("type","button"),n.id=`invoice-request-btn-${e}`,n.textContent="Req. invoice";const a=document.createElement("div");a.classList.add("btn-group"),a.setAttribute("role","group");const o=document.createElement("button");o.classList.add("btn","btn-primary","dropdown-toggle","inv-req","inv-req-menu"),o.setAttribute("type","button"),o.setAttribute("aria-expanded",!1),o.dataset.bsToggle="dropdown";const s=document.createElement("span");s.classList.add("dropdown-item","btn"),s.textContent="Specify pay period";const c=document.createElement("li"),d=document.createElement("ul");return d.classList.add("dropdown-menu"),o.append(a),c.append(s),d.append(c),r.append(n),r.append(o),r.append(d),d.addEventListener("click",(()=>{_(t)})),n.addEventListener("click",(t=>{const r=t.target.closest("table");console.log(e),y(e,r)})),r})(e,r)},{data:"id",render:e=>c("div",{classes:["btn-group","btn-group-sm"],attributes:{role:"group"},children:[["a",{classes:["btn","btn-outline-secondary"],attributes:{href:`/pipeline/${e}/update-cost/`},children:[["img",{attributes:{src:A,alt:"edit icon"}}]]}],["a",{classes:["btn","btn-outline-secondary"],attributes:{href:`/pipeline/${e}/delete-cost/`},children:[["img",{attributes:{src:L,alt:"delete icon"}}]]}]]})},{data:"id",visible:!1}],rowCallback:(e,t)=>((e,t)=>{((e,t)=>{"NR"===t.invoice_status&&0!=t.vendor_id?e.querySelectorAll(".inv-req").forEach((e=>e.removeAttribute("disabled"))):e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled","")))})(e,t),0==t.vendor_id&&(e.querySelector("select.status").style.display="none",e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled",""))))})(e,t)}),C),t=()=>e().table().container().querySelector("table");return{getOrInitTable:e,getTableEl:t,refresh:()=>C.ajax.reload(),setupTableEventHandlers:(e=t())=>{j(e),((e,t=n)=>{t.form.addEventListener("submit",(r=>t.submitForm(r,e)))})(e)}}})();k.getOrInitTable(),k.setupTableEventHandlers(),m.setup()}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var o=r[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.m=t,e=[],n.O=function(t,r,a,o){if(!r){var s=1/0;for(l=0;l<e.length;l++){r=e[l][0],a=e[l][1],o=e[l][2];for(var c=!0,d=0;d<r.length;d++)(!1&o||s>=o)&&Object.keys(n.O).every((function(e){return n.O[e](r[d])}))?r.splice(d--,1):(c=!1,o<s&&(s=o));if(c){e.splice(l--,1);var i=a();void 0!==i&&(t=i)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[r,a,o]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/static/",function(){var e={977:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var a,o,s=r[0],c=r[1],d=r[2],i=0;if(s.some((function(t){return 0!==e[t]}))){for(a in c)n.o(c,a)&&(n.m[a]=c[a]);if(d)var l=d(n)}for(t&&t(r);i<s.length;i++)o=s[i],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(l)},r=self.webpackChunknpt=self.webpackChunknpt||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var a=n.O(void 0,[547],(function(){return n(7418)}));a=n.O(a)}();
//# sourceMappingURL=costsheet.js.map