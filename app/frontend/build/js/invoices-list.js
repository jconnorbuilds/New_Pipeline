!function(){"use strict";var e,t={337:function(e,t,r){var n={};r.r(n),r.d(n,{defineMenu:function(){return f},form:function(){return m},launchModal:function(){return h},submitForm:function(){return y}});var o=DataTable,a=r.n(o),s=jQuery,i=r.n(s);const d=document.querySelector("[name=csrfmiddlewaretoken]")?document.querySelector("[name=csrfmiddlewaretoken]").value:null,c=(e,t=30)=>{const r=Math.round(.5*t),n=(e=>{const t=e.match(/[\u3040-\u309F\u30A0-\u30FF\uFF01-\uFF5E\u4E00-\u9FAF\u3400-\u4DBF]/gu);return t?t.length:0})(e),o=e.length;return n>r?e.substring(0,r)+"...":n>=.66*t&&o>.5*t?e.substring(0,Math.round(.5*t))+"...":n>=.33*t&&o>.33*t?e.substring(0,.33*t)+"...":n>=.125*t&&o>.83*t?e.substring(0,Math.round(.83*t))+"...":o>t?e.substring(0,t)+"...":e};var l=r(9635),u=r.n(l);const p=(e,t,r="next")=>{console.log({costID:e},{table:t}),i().ajax({headers:{"X-CSRFToken":d},url:"/pipeline/request-single-invoice/"+e+"/",method:"POST",data:{pay_period:r},dataType:"json",success:function(e){console.log("invoice request callback: ",e),new(a())(t).row(`#${e.response.id}`).data(e.response).invalidate().draw(!1)},error:e=>{console.warn(e),alert("There was an error. Try again, and if the error persists, request the invoice the old fashioned way")}})},m=document.querySelector("form#pay-period-form"),b=document.querySelector("#pay-period-modal"),v=new(u())(b),f=e=>e.querySelector("ul.dropdown-menu > li"),g=document.querySelector("#pay-period-modal .invoice-desc");b.addEventListener("hide.bs.modal",(()=>{m.reset(),g.innerHTML=""}));const y=(e,t)=>{e.preventDefault();const r=document.querySelector("#pay-period-form #id_cost_id").value,n=document.querySelector("#pay-period-form #id_pay_period").value;p(r,t,n),v.hide()},h=e=>{console.log({rowData:e});const t=document.querySelector("#pay-period-modal #id_cost_id");[`Vendor name: ${e.vendor_name}`,`PO number: ${e.PO_number}`,`Job name: ${e.job_name}`].forEach((e=>{const t=document.createElement("p");t.textContent=e,g.appendChild(t)})),t.value=e.id,v.show()};window.$=i();const w=document.querySelectorAll(".display-filter .status-filter"),_=(e,t)=>{"success"===e.status?new(a())(t).ajax.reload():console.error(e.message)};let S,E;var q=(()=>{const e=()=>S||(()=>{if(!S){const e=a().absoluteOrder("null"),t=a().absoluteOrder("null");E=document.querySelector("#all-invoices-table"),S=new(a())(E,{paging:!0,pagingType:"simple_numbers",deferRender:!0,processing:!0,pageLength:50,autoWidth:!0,order:[{name:"invoicePeriod",dir:"desc"},{name:"jobCode",dir:"asc"}],orderClasses:!1,language:{searchPlaceholder:"コストを探す",search:""},ajax:{url:"/pipeline/all-invoices-data/"},rowId:"id",columns:[{data:"job_id",render:e=>`<a href="/pipeline/cost-add/${e}">Cost Sheet</a>`},{data:"amount_JPY",className:"px-4 dt-right",render:e=>(e=>"¥"+e.toLocaleString())(e)},{data:"amount",className:"px-4 dt-right",responsivePriority:1,render:(e,t,r)=>{return n=e,"JPY"==(o={name:r.currency,symbol:r.currency_symbol}).name?"":o.symbol+n.toLocaleString();var n,o}},{data:"job_date",name:"invoicePeriod",className:"invoice-period",render:e=>{let t=new Date(e);return e?`${t.getFullYear()}年${t.getMonth()+1}月`:"---"},type:e},{data:"job_name",render:{display:e=>c(e),sort:e=>e}},{data:"job_code",name:"jobCode"},{data:"vendor_name"},{data:"description",render:e=>c(e,16)},{data:"PO_number",render:{display:e=>e,sort:(e,t,r)=>null===e?"":r.vendor_code+e.slice(-4)}},{data:"invoice_status",name:"invoiceStatus",className:"px-3",width:"210px",render:(e,t,r)=>((e,t)=>{const r=t.invoice_status_choices,n=document.createElement("select");n.classList.add("form-control-plaintext","status","p-0"),n.setAttribute("name","invoice_status");for(const[t,o]of Object.entries(r)){const t=document.createElement("option");t.value=o[0],t.text=o[1],o[0]===e&&t.setAttribute("selected",""),n.appendChild(t)}return n.outerHTML})(e,r),type:t},{data:"pay_period",render:e=>(e=>{if(e){const t=new Date(e);return`${new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"long",timeZone:"UTC"}).format(t)}末`}return"-"})(e)},{data:"id",render:(e,t,r)=>((e,t)=>{const r=document.createElement("div");r.classList.add("btn-group","btn-group-sm"),r.setAttribute("role","group"),r.setAttribute("aria-label","Invoice request button with nested dropdown");const n=document.createElement("button");n.classList.add("btn","btn-primary","inv-req","inv-req-btn"),n.setAttribute("type","button"),n.id=`invoice-request-btn-${e}`,n.textContent="Req. invoice";const o=document.createElement("div");o.classList.add("btn-group"),o.setAttribute("role","group");const a=document.createElement("button");a.classList.add("btn","btn-primary","dropdown-toggle","inv-req","inv-req-menu"),a.setAttribute("type","button"),a.setAttribute("aria-expanded",!1),a.dataset.bsToggle="dropdown";const s=document.createElement("span");s.classList.add("dropdown-item","btn"),s.textContent="Specify pay period";const i=document.createElement("li"),d=document.createElement("ul");return d.classList.add("dropdown-menu"),a.append(o),i.append(s),d.append(i),r.append(n),r.append(a),r.append(d),d.addEventListener("click",(()=>{h(t)})),n.addEventListener("click",(t=>{const r=t.target.closest("table");p(e,r)})),r})(e,r)},{data:"id",visible:!1},{data:"person_in_charge",visible:!1}],columnDefs:[{targets:[0,-2,-3],orderable:!1},{targets:[1,2,5],createdCell:function(e){e.classList.add("font-monospace")}}],rowCallback:(e,t)=>((e,t)=>{((e,t)=>{"NR"===t.invoice_status&&0!=t.vendor_id?e.querySelectorAll(".inv-req").forEach((e=>e.removeAttribute("disabled"))):e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled","")))})(e,t),0==t.vendor_id&&(e.querySelector("select.status").style.display="none",e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled",""))))})(e,t)})}return(()=>{const e={NR:1,REQ:2,REC:3,REC2:4,ERR:5,QUE:6,PAID:7,NA:8};a().ext.type.order["status-pre"]=t=>e[t]||-1})(),S})();return{getOrInitTable:e,getTableEl:()=>e().table().container().querySelector("table"),refresh:()=>S.ajax.reload()}})();q.getOrInitTable(),((e=q.getOrInitTable(),t=q.getTableEl())=>{(e=>{e.addEventListener("change",(e=>{e.target.matches("select.status")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,o=t.closest("tr").getAttribute("id");i().ajax({headers:{"X-CSRFToken":d},method:"POST",url:"/pipeline/update-invoice-table-row",data:{status:n,cost_id:o},dataType:"json",success:e=>_(e,r),error:e=>console.warn(e)})})(e),e.target.matches("select.vendor")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,o=t.closest("tr").getAttribute("id");i().ajax({headers:{"X-CSRFToken":d},method:"POST",url:"/pipeline/update-invoice-table-row",data:{vendor:n,cost_id:o},dataType:"json",success:e=>_(e,r),error:e=>console.warn(e)})})(e)}))})(t),((e,t=n)=>{t.form.addEventListener("submit",(r=>t.submitForm(r,e)))})(t),document.querySelectorAll(".display-filter input").forEach((t=>t.addEventListener("change",(()=>e.draw()))))})(),a().ext.search.push((function(e,t){const r=(new DOMParser).parseFromString(t[9],"text/html").querySelector("select").value;let n=[];return w.forEach((e=>{e.checked&&n.push(e.value.toUpperCase())})),!(n.length>0&&!n.includes(r))}))}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}};return t[e].call(a.exports,a,a.exports,n),a.exports}n.m=t,e=[],n.O=function(t,r,o,a){if(!r){var s=1/0;for(l=0;l<e.length;l++){r=e[l][0],o=e[l][1],a=e[l][2];for(var i=!0,d=0;d<r.length;d++)(!1&a||s>=a)&&Object.keys(n.O).every((function(e){return n.O[e](r[d])}))?r.splice(d--,1):(i=!1,a<s&&(s=a));if(i){e.splice(l--,1);var c=o();void 0!==c&&(t=c)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[r,o,a]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={596:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var o,a,s=r[0],i=r[1],d=r[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(d)var l=d(n)}for(t&&t(r);c<s.length;c++)a=s[c],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(l)},r=self.webpackChunknpt=self.webpackChunknpt||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var o=n.O(void 0,[547],(function(){return n(337)}));o=n.O(o)}();
//# sourceMappingURL=invoices-list.js.map