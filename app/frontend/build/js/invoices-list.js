!function(){"use strict";var e,t={337:function(e,t,r){var n={};r.r(n),r.d(n,{defineMenu:function(){return h},form:function(){return m},launchModal:function(){return S},submitForm:function(){return g}});var o=DataTable,a=r.n(o),s=jQuery,i=r.n(s);const d=document.querySelector("[name=csrfmiddlewaretoken]")?document.querySelector("[name=csrfmiddlewaretoken]").value:null,l=(e,t=30)=>{const r=Math.round(.5*t),n=(e=>{const t=e.match(/[\u3040-\u309F\u30A0-\u30FF\uFF01-\uFF5E\u4E00-\u9FAF\u3400-\u4DBF]/gu);return t?t.length:0})(e),o=e.length;return n>r?e.substring(0,r)+"...":n>=.66*t&&o>.5*t?e.substring(0,Math.round(.5*t))+"...":n>=.33*t&&o>.33*t?e.substring(0,.33*t)+"...":n>=.125*t&&o>.83*t?e.substring(0,Math.round(.83*t))+"...":o>t?e.substring(0,t)+"...":e},c=(e,t={})=>{const r=document.createElement(e);return t.classes&&("string"==typeof t.classes?r.classList.add(t.classes):r.classList.add(...t.classes)),t.attributes&&Object.keys(t.attributes).forEach((e=>{r.setAttribute(e,t.attributes[e])})),t.text&&(r.textContent=t.text),t.children&&t.children.forEach((e=>{r.appendChild(c(...e))})),t.id&&(r.id=t.id),t.data&&Object.keys(t.data).forEach((e=>{r.dataset[e]=t.data[e]})),r};var u=r(635),p=r.n(u);const b=(e,t,r="next")=>{i().ajax({headers:{"X-CSRFToken":d},url:"/pipeline/request-single-invoice/"+e+"/",method:"POST",data:{pay_period:r},dataType:"json",success:function(e){console.log("invoice request callback: ",e),new(a())(t).row(`#${e.response.id}`).data(e.response).invalidate().draw(!1)},error:e=>{console.warn(e),alert("There was an error. Try again, and if the error persists, request the invoice the old fashioned way")}})},m=document.querySelector("form#pay-period-form"),v=document.querySelector("#pay-period-modal"),f=new(p())(v),h=e=>e.querySelector("ul.dropdown-menu > li"),y=document.querySelector("#pay-period-modal .invoice-desc");v.addEventListener("hide.bs.modal",(()=>{m.reset(),y.innerHTML=""}));const g=(e,t)=>{e.preventDefault();const r=document.querySelector("#pay-period-form #id_cost_id").value,n=document.querySelector("#pay-period-form #id_pay_period").value;b(r,t,n),f.hide()},S=e=>{const t=document.querySelector("#pay-period-modal #id_cost_id");[`Vendor name: ${e.vendor_name}`,`PO number: ${e.PO_number}`,`Job name: ${e.job_name}`].forEach((e=>{const t=document.createElement("p");t.textContent=e,y.appendChild(t)})),t.value=e.id,f.show()};window.$=i();const _=document.querySelectorAll(".display-filter .status-filter"),w=(e,t)=>{"success"===e.status?new(a())(t).ajax.reload():console.error(e.message)};let q,E;const x=()=>{if(!q){const e=a().absoluteOrder("null"),t=a().absoluteOrder("null");E=document.querySelector("#all-invoices-table"),q=new(a())(E,{paging:!0,pagingType:"simple_numbers",deferRender:!0,processing:!0,pageLength:50,autoWidth:!0,order:[{name:"invoicePeriod",dir:"desc"},{name:"jobCode",dir:"asc"}],orderClasses:!1,language:{searchPlaceholder:"コストを探す",search:""},ajax:{url:"/pipeline/all-invoices-data/"},rowId:"id",columns:[{data:"job_id",render:e=>`<a href="/pipeline/cost-add/${e}">Cost Sheet</a>`},{data:"amount_JPY",className:"px-4 dt-right",render:e=>(e=>"¥"+e.toLocaleString())(e)},{data:"amount",className:"px-4 dt-right",responsivePriority:1,render:{display:(e,t,r)=>{return n=e,"JPY"==(o={name:r.currency,symbol:r.currency_symbol}).name?"":o.symbol+n.toLocaleString();var n,o},sort:e=>e}},{data:"job_date",name:"invoicePeriod",className:"invoice-period",render:{display:e=>{let t=new Date(e);return e?`${t.getFullYear()}年${t.getMonth()+1}月`:"---"},sort:e=>e},type:e},{data:"job_name",render:{display:e=>l(e),sort:e=>e}},{data:"job_code",name:"jobCode"},{data:"vendor_name"},{data:"description",render:e=>l(e,16)},{data:"PO_number",render:{display:e=>e,sort:(e,t,r)=>null===e?"":r.vendor_code+e.slice(-4)}},{data:"invoice_status",name:"invoiceStatus",className:"px-3",width:"210px",render:(e,t,r)=>(console.log({data:e}),((e,t)=>{const r=t.invoice_status_choices,n=document.createElement("select");n.classList.add("form-control-plaintext","status","p-0"),n.setAttribute("name","invoice_status");for(const[t,o]of Object.entries(r)){const t=document.createElement("option");t.value=o[0],t.text=o[1],o[0]===e&&t.setAttribute("selected",""),n.appendChild(t)}return n.outerHTML})(e,r)),type:t},{data:"pay_period",render:e=>(e=>e?`${e.split("-")[0]}年${e.split("-")[1]}月末`:"-")(e)},{data:"id",responsivePriority:3,render:e=>(e=>c("div",{classes:["btn-group","btn-group-sm"],attributes:{role:"group","aria-label":"Invoice request button with nested dropdown"},children:[["button",{classes:["btn","btn-primary","inv-req","inv-req-btn"],attributes:{type:"button"},id:`invoice-request-btn-${e}`,text:"Req. invoice"}],["button",{classes:["btn","btn-primary","dropdown-toggle","inv-req","inv-req-menu"],attributes:{type:"button","aria-expanded":!1},data:{bsToggle:"dropdown"},children:[["div",{classes:"btn-group",attributes:{role:"group"}}]]}],["ul",{classes:"dropdown-menu",children:[["li",{children:[["span",{classes:"dropdown-item",text:"Specify pay period"}]]}]]}]]}).outerHTML)(e)},{data:"id",visible:!1},{data:"person_in_charge",visible:!1}],columnDefs:[{targets:[0,-2,-3],orderable:!1},{targets:[1,2,5],createdCell:function(e){e.classList.add("font-monospace")}}],rowCallback:(e,t)=>((e,t)=>{((e,t)=>{"NR"===t.invoice_status&&0!=t.vendor_id?e.querySelectorAll(".inv-req").forEach((e=>e.removeAttribute("disabled"))):e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled","")))})(e,t),0==t.vendor_id&&(e.querySelector("select.status").style.display="none",e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled",""))))})(e,t),createdRow:(e,t)=>{((e,t)=>{((e,t)=>{e.querySelector("button.inv-req-btn").addEventListener("click",(e=>{const r=e.target.closest("table");b(t.id,r)}))})(e,t),h(e).addEventListener("click",(()=>{S(t)}))})(e,t)}})}return(()=>{const e={NR:1,REQ:2,REC:3,REC2:4,ERR:5,QUE:6,PAID:7,NA:8};a().ext.type.order["status-pre"]=t=>e[t]||-1})(),q};var O=(()=>{const e=()=>q||x();return{getOrInitTable:e,getTableEl:()=>e().table().container().querySelector("table"),refresh:()=>q.ajax.reload()}})();O.getOrInitTable(),((e=O.getOrInitTable(),t=O.getTableEl())=>{(e=>{e.addEventListener("change",(e=>{e.target.matches("select.status")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,o=t.closest("tr").getAttribute("id");i().ajax({headers:{"X-CSRFToken":d},method:"POST",url:"/pipeline/update-invoice-table-row",data:{status:n,cost_id:o},dataType:"json",success:e=>w(e,r),error:e=>console.warn(e)})})(e),e.target.matches("select.vendor")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,o=t.closest("tr").getAttribute("id");i().ajax({headers:{"X-CSRFToken":d},method:"POST",url:"/pipeline/update-invoice-table-row",data:{vendor:n,cost_id:o},dataType:"json",success:e=>w(e,r),error:e=>console.warn(e)})})(e)}))})(t),((e,t=n)=>{t.form.addEventListener("submit",(r=>t.submitForm(r,e)))})(t),document.querySelectorAll(".display-filter input").forEach((t=>t.addEventListener("change",(()=>e.draw()))))})(),a().ext.search.push((function(e,t){const r=(new DOMParser).parseFromString(t[9],"text/html").querySelector("select").value;let n=[];return _.forEach((e=>{e.checked&&n.push(e.value.toUpperCase())})),!(n.length>0&&!n.includes(r))}))}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}};return t[e].call(a.exports,a,a.exports,n),a.exports}n.m=t,e=[],n.O=function(t,r,o,a){if(!r){var s=1/0;for(c=0;c<e.length;c++){r=e[c][0],o=e[c][1],a=e[c][2];for(var i=!0,d=0;d<r.length;d++)(!1&a||s>=a)&&Object.keys(n.O).every((function(e){return n.O[e](r[d])}))?r.splice(d--,1):(i=!1,a<s&&(s=a));if(i){e.splice(c--,1);var l=o();void 0!==l&&(t=l)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,o,a]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},function(){var e={596:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var o,a,s=r[0],i=r[1],d=r[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(o in i)n.o(i,o)&&(n.m[o]=i[o]);if(d)var c=d(n)}for(t&&t(r);l<s.length;l++)a=s[l],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(c)},r=self.webpackChunknpt=self.webpackChunknpt||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var o=n.O(void 0,[547],(function(){return n(337)}));o=n.O(o)}();
//# sourceMappingURL=invoices-list.js.map