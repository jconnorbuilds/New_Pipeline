!function(){"use strict";var e,t={418:function(e,t,r){var n={};r.r(n),r.d(n,{defineMenu:function(){return w},form:function(){return g},launchModal:function(){return _},submitForm:function(){return T}});var a=jQuery,o=r.n(a);const s=document.querySelector("[name=csrfmiddlewaretoken]")?document.querySelector("[name=csrfmiddlewaretoken]").value:null,i=(e,t={})=>{const r=document.createElement(e);return t.classes&&("string"==typeof t.classes?r.classList.add(t.classes):r.classList.add(...t.classes)),t.attributes&&Object.keys(t.attributes).forEach((e=>{r.setAttribute(e,t.attributes[e])})),t.text&&(r.textContent=t.text),t.children&&t.children.forEach((e=>{r.appendChild(i(...e))})),t.id&&(r.id=t.id),t.data&&Object.keys(t.data).forEach((e=>{r.dataset[e]=t.data[e]})),r},c=document.querySelector("#calcInput"),l=document.querySelector("#calcResult"),d=document.querySelector("#calcFrom"),u=document.querySelector("#calcTo"),p=(e,t)=>{const r=i("option",{attributes:{value:e},text:e});return r.value===t&&r.setAttribute("selected",""),r};var b=(()=>{const e=e=>{Object.keys(e).sort().forEach((e=>{const t=p(e,"JPY"),r=p(e,"EUR");d.appendChild(t),u.appendChild(r)}));const t=(e,t)=>{return e.value?r(e,t):(n=t,e.value=0,n.value="0.00");var n},r=(t,r)=>{var n,a,o,s,i;return t.value=(n=t.value,parseInt(n.replaceAll(",","")).toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),r.value=(e=>e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","))((a=t.value,o=e[d.value],s=e[u.value],(i=a,parseInt(i.replaceAll(",",""))*(o/s)).toFixed(2))),r.value};c.addEventListener("input",(()=>t(c,l))),[d,u].forEach((e=>{e.addEventListener("change",(()=>t(c,l)))}))};return{setup:()=>{var t;t=t=>e(t),o().ajax({headers:{"X-CSRFToken":s},method:"GET",url:"/pipeline/forex-rates",dataType:"json",success:t,error:e=>alert(e)})}}})(),m=DataTable,v=r.n(m),f=r(635),h=r.n(f);const y=(e,t,r="next")=>{o().ajax({headers:{"X-CSRFToken":s},url:"/pipeline/request-single-invoice/"+e+"/",method:"POST",data:{pay_period:r},dataType:"json",success:function(e){console.log("invoice request callback: ",e),new(v())(t).row(`#${e.response.id}`).data(e.response).invalidate().draw(!1)},error:e=>{console.warn(e),alert("There was an error. Try again, and if the error persists, request the invoice the old fashioned way")}})},g=document.querySelector("form#pay-period-form"),S=document.querySelector("#pay-period-modal"),q=new(h())(S),w=e=>e.querySelector("ul.dropdown-menu > li"),E=document.querySelector("#pay-period-modal .invoice-desc");S.addEventListener("hide.bs.modal",(()=>{g.reset(),E.innerHTML=""}));const T=(e,t)=>{e.preventDefault();const r=document.querySelector("#pay-period-form #id_cost_id").value,n=document.querySelector("#pay-period-form #id_pay_period").value;y(r,t,n),q.hide()},_=e=>{const t=document.querySelector("#pay-period-modal #id_cost_id");[`Vendor name: ${e.vendor_name}`,`PO number: ${e.PO_number}`,`Job name: ${e.job_name}`].forEach((e=>{const t=document.createElement("p");t.textContent=e,E.appendChild(t)})),t.value=e.id,q.show()};window.$=o();const x=(e,t,r,n)=>{const a=document.createElement("option");a.value=e,a.text=t,r.appendChild(a),e==n.vendor_id&&a.setAttribute("selected","")},O=(document.querySelectorAll(".display-filter .status-filter"),e=>{e.addEventListener("change",(e=>{e.target.matches("select.status")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,a=t.closest("tr").getAttribute("id");o().ajax({headers:{"X-CSRFToken":s},method:"POST",url:"/pipeline/update-invoice-table-row",data:{status:n,cost_id:a},dataType:"json",success:e=>j(e,r),error:e=>console.warn(e)})})(e),e.target.matches("select.vendor")&&(e=>{const t=e.target,r=t.closest("table"),n=t.value,a=t.closest("tr").getAttribute("id");o().ajax({headers:{"X-CSRFToken":s},method:"POST",url:"/pipeline/update-invoice-table-row",data:{vendor:n,cost_id:a},dataType:"json",success:e=>j(e,r),error:e=>console.warn(e)})})(e)}))}),j=(e,t)=>{"success"===e.status?new(v())(t).ajax.reload():console.error(e.message)};var A=r.p+"assets/images/pencil-square.svg",k=r.p+"assets/images/trash3-fill.svg";let F,L;const C=()=>(L=document.querySelector("#cost-table"),F=new(v())(L,{paging:!1,processing:!0,dom:"lrtp",autoWidth:!0,order:[[0,"asc"]],orderClasses:!1,language:{searchPlaceholder:"コストを探す",search:"",emptyTable:"No costs for this job!"},ajax:{url:"/pipeline/cost-data/"+window.location.href.split("/").slice(-2,-1)[0]},rowId:"id",columns:[{data:"amount_JPY",className:"dt-right pe-4",render:e=>(e=>"¥"+e.toLocaleString())(e)},{data:"amount",className:"dt-right pe-4",render:{display:(e,t,r)=>{return n=e,"JPY"==(a={name:r.currency,symbol:r.currency_symbol}).name?"":a.symbol+n.toLocaleString();var n,a},sort:e=>e}},{data:"vendor_name",render:{display:(e,t,r)=>(e=>{const t=e.vendors_dict?e.vendors_dict:null,r=document.createElement("select");return r.classList.add("form-control-plaintext","vendor"),r.setAttribute("name","vendor-select"),x(0,"Select vendor",r,e),t&&Object.entries(t).forEach((([t,n])=>{x(t,n,r,e)})),r.outerHTML})(r),sort:e=>e}},{data:"description",render:e=>((e,t=30)=>{const r=Math.round(.5*t),n=(e=>{const t=e.match(/[\u3040-\u309F\u30A0-\u30FF\uFF01-\uFF5E\u4E00-\u9FAF\u3400-\u4DBF]/gu);return t?t.length:0})(e),a=e.length;return n>r?e.substring(0,r)+"...":n>=.66*t&&a>.5*t?e.substring(0,Math.round(.5*t))+"...":n>=.33*t&&a>.33*t?e.substring(0,.33*t)+"...":n>=.125*t&&a>.83*t?e.substring(0,Math.round(.83*t))+"...":a>t?e.substring(0,t)+"...":e})(e)},{data:"PO_number"},{data:"invoice_status",orderDataType:"dom-cost-select",className:"p-0",render:{display:(e,t,r)=>((e,t)=>{const r=t.invoice_status_choices,n=document.createElement("select");n.classList.add("form-control-plaintext","status","p-0"),n.setAttribute("name","invoice_status");for(const[t,a]of Object.entries(r)){const t=document.createElement("option");t.value=a[0],t.text=a[1],a[0]===e&&t.setAttribute("selected",""),n.appendChild(t)}return n.outerHTML})(e,r),sort:e=>e}},{data:"pay_period",render:e=>(e=>e?`${e.split("-")[0]}年${e.split("-")[1]}月末`:"-")(e)},{data:"id",render:e=>(e=>i("div",{classes:["btn-group","btn-group-sm"],attributes:{role:"group","aria-label":"Invoice request button with nested dropdown"},children:[["button",{classes:["btn","btn-primary","inv-req","inv-req-btn"],attributes:{type:"button"},id:`invoice-request-btn-${e}`,text:"Req. invoice"}],["button",{classes:["btn","btn-primary","dropdown-toggle","inv-req","inv-req-menu"],attributes:{type:"button","aria-expanded":!1},data:{bsToggle:"dropdown"},children:[["div",{classes:"btn-group",attributes:{role:"group"}}]]}],["ul",{classes:"dropdown-menu",children:[["li",{children:[["span",{classes:"dropdown-item",text:"Specify pay period"}]]}]]}]]}).outerHTML)(e)},{data:"id",render:e=>i("div",{classes:["btn-group","btn-group-sm"],attributes:{role:"group"},children:[["a",{classes:["btn","btn-outline-secondary"],attributes:{href:`/pipeline/${e}/update-cost/`},children:[["img",{attributes:{src:A,alt:"edit icon"}}]]}],["a",{classes:["btn","btn-outline-secondary"],attributes:{href:`/pipeline/${e}/delete-cost/`},children:[["img",{attributes:{src:k,alt:"delete icon"}}]]}]]}).outerHTML},{data:"id",visible:!1}],rowCallback:(e,t)=>((e,t)=>{((e,t)=>{"NR"===t.invoice_status&&0!=t.vendor_id?e.querySelectorAll(".inv-req").forEach((e=>e.removeAttribute("disabled"))):e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled","")))})(e,t),0==t.vendor_id&&(e.querySelector("select.status").style.display="none",e.querySelectorAll(".inv-req").forEach((e=>e.setAttribute("disabled",""))))})(e,t),createdRow:(e,t)=>{((e,t)=>{((e,t)=>{e.querySelector("button.inv-req-btn").addEventListener("click",(e=>{const r=e.target.closest("table");y(t.id,r)}))})(e,t),w(e).addEventListener("click",(()=>{_(t)}))})(e,t)}}),F);var P=(()=>{const e=()=>F||C(),t=()=>e().table().container().querySelector("table");return{getOrInitTable:e,getTableEl:t,refresh:()=>F.ajax.reload(),setupTableEventHandlers:(e=t())=>{O(e),((e,t=n)=>{t.form.addEventListener("submit",(r=>t.submitForm(r,e)))})(e)}}})();P.getOrInitTable(),P.setupTableEventHandlers(),b.setup()}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var o=r[e]={exports:{}};return t[e].call(o.exports,o,o.exports,n),o.exports}n.m=t,e=[],n.O=function(t,r,a,o){if(!r){var s=1/0;for(d=0;d<e.length;d++){r=e[d][0],a=e[d][1],o=e[d][2];for(var i=!0,c=0;c<r.length;c++)(!1&o||s>=o)&&Object.keys(n.O).every((function(e){return n.O[e](r[c])}))?r.splice(c--,1):(i=!1,o<s&&(s=o));if(i){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[r,a,o]},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/static/",function(){var e={977:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var a,o,s=r[0],i=r[1],c=r[2],l=0;if(s.some((function(t){return 0!==e[t]}))){for(a in i)n.o(i,a)&&(n.m[a]=i[a]);if(c)var d=c(n)}for(t&&t(r);l<s.length;l++)o=s[l],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return n.O(d)},r=self.webpackChunknpt=self.webpackChunknpt||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))}();var a=n.O(void 0,[547],(function(){return n(418)}));a=n.O(a)}();
//# sourceMappingURL=costsheet.js.6279010ece76.map